<div class="container-fluid p-0">
  <div class="map-search">
    <%= form_tag parkings_path, class: "form-inline", method: :get do %>
      <%= text_field_tag :query,
            params[:query],
            class: "form-control map-text-input",
            placeholder: "Search location"
          %>
      <%= submit_tag "Search", id: "search", class: "btn-yellow text-body" %>
    <% end %>
  </div>
  <div id="map" style="width: 100%; height: 74vh;" data-markers="<%= @markers.to_json %>" data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>" data-destination="<%= @destination %>">
  </div>
  <%= render 'pin_form' %>
  <div class="owl-carousel owl-theme card-carousel">
    <% @parkings.each do |parking| %>
      <div data-id="<%= parking.id %>" class="card flex-row">
        <div class="card-image">
          <%= cl_image_tag(parking.photos.first.key, width: 128, height: 144, crop: :fill) %>
        </div>
        <div class="card-details d-flex flex-column pl-3 py-2">
          <%= link_to toggle_favorite_parking_path(parking), remote: true, method: :post do %>
            <%= render 'parkings/like_button', parking: parking %>
          <% end %>
          <div class="flex-grow-1">
            <p class="mb-2 font-weight-bold"><%= parking.name %></p>
          </div>
          <div class="d-flex">
            <%= render 'parkings/average_rating', parking: parking %>
            <div class="ml-3 align-self-end">
              <% unless parking.average_risk_score == nil %>
                <p class="mb-0">Safety: <%= parking.average_risk_score %>%</p>
              <% else %>
                <p class="mb-0"><em>No reviews</em></p>
              <% end %>
            </div>
          </div>
          <div class="card-action d-flex">
            <%= link_to parking_path(parking) do %>
              <p class="mb-0 mr-4"><i class="fas fa-info-circle"></i> Info</p>
            <% end %>
            <%= link_to parkings_path(to_parking: parking.id) do %>
              <p class="mb-0 mr-2"><i class="fas fa-directions"></i> Directions</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>